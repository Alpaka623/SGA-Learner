<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lerne das Standard Galactic Alphabet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-image-dark: url('https://placehold.co/1920x1080/0c0a1e/0c0a1e?text=');
            --bg-color-dark: #0c0a1e;
            --text-color-dark: #e0e0e0;
            --card-bg-dark: rgba(30, 27, 58, 0.7);
            --card-border-dark: #a855f7;
            --btn-primary-bg-dark: #8b5cf6;
            --btn-primary-hover-bg-dark: #a855f7;
            --btn-option-bg-dark: #282347;
            --btn-option-border-dark: #4c1d95;
            --btn-option-hover-bg-dark: #4c1d95;
            --pixel-color-dark: #FFFFFF;
            --glowing-text-shadow-dark: 0 0 8px #d946ef, 0 0 12px #d946ef;

            --bg-image-light: url('https://images.unsplash.com/photo-1593369459307-d4724da273de?q=80&w=1920&auto=format&fit=crop');
            --bg-color-light: #effaee;
            --text-color-light: #4a4a4a;
            --card-bg-light: rgba(255, 255, 255, 0.8);
            --card-border-light: #876145;
            --btn-primary-bg-light: #5a9a50;
            --btn-primary-hover-bg-light: #6cba60;
            --btn-option-bg-light: #d3b8a3;
            --btn-option-border-light: #876145;
            --btn-option-hover-bg-light: #bca08a;
            --pixel-color-light: #000000;
            --glowing-text-shadow-light: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-image: var(--bg-image-dark);
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
            transition: background-color 0.5s, color 0.5s;
        }
        .card {
            background-color: var(--card-bg-dark);
            border: 1px solid var(--card-border-dark);
            backdrop-filter: blur(10px);
            transition: background-color 0.5s, border-color 0.5s;
        }
        .btn-primary, .btn-menu {
            background-color: var(--btn-primary-bg-dark);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-primary:hover, .btn-menu:hover {
            background-color: var(--btn-primary-hover-bg-dark);
            transform: translateY(-2px);
        }
        .btn-option {
            background-color: var(--btn-option-bg-dark);
            border: 1px solid var(--btn-option-border-dark);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70px;
        }
        .btn-option:hover {
            background-color: var(--btn-option-hover-bg-dark);
            border-color: var(--btn-option-hover-bg-dark);
        }
        .btn-option.correct {
            background-color: #22c55e !important;
            border-color: #16a34a !important;
            color: white;
        }
        .btn-option.incorrect {
            background-color: #ef4444 !important;
            border-color: #dc2626 !important;
            color: white;
        }
        .progress-bar-bg {
            background-color: var(--btn-option-bg-dark);
        }
        .progress-bar-fill {
            background: var(--btn-primary-bg-dark);
            transition: width 0.5s ease-in-out, background-color 0.5s;
        }
        .keyboard-key {
            cursor: pointer;
            user-select: none;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .keyboard-key:active {
            transform: scale(0.95);
        }
        .input-box {
            min-height: 80px;
            background-color: rgba(12, 10, 30, 0.8);
            border: 1px dashed var(--btn-option-border-dark);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .glowing-text {
            text-shadow: var(--glowing-text-shadow-dark);
        }
        .question-display-container {
            min-height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pixel-on {
            background-color: var(--pixel-color-dark);
        }

        /* Light Mode Styles */
        body.light-mode {
            background-image: var(--bg-image-light);
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
        }
        .light-mode .card {
            background-color: var(--card-bg-light);
            border-color: var(--card-border-light);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .light-mode .btn-primary, .light-mode .btn-menu {
            background-color: var(--btn-primary-bg-light);
            color: white;
        }
        .light-mode .btn-primary:hover, .light-mode .btn-menu:hover {
            background-color: var(--btn-primary-hover-bg-light);
        }
        .light-mode .btn-option {
            background-color: var(--btn-option-bg-light);
            border-color: var(--btn-option-border-light);
            color: var(--text-color-light);
        }
        .light-mode .btn-option:hover {
            background-color: var(--btn-option-hover-bg-light);
        }
        .light-mode .progress-bar-bg {
            background-color: #d3b8a3;
        }
        .light-mode .progress-bar-fill {
            background: var(--btn-primary-bg-light);
        }
        .light-mode .input-box {
            background-color: rgba(255, 255, 255, 0.6);
            border-color: var(--btn-option-border-light);
        }
        .light-mode .glowing-text {
            text-shadow: var(--glowing-text-shadow-light);
        }
        .light-mode #level-title, .light-mode .glowing-text, .light-mode .menu-title {
            color: #4a7a42;
        }
        .light-mode .pixel-on {
            background-color: var(--pixel-color-light);
        }

        #theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            background-color: rgba(40, 35, 71, 0.7);
            border-radius: 9999px;
            padding: 8px;
            border: 1px solid #4c1d95;
            z-index: 50;
        }
        .light-mode #theme-toggle {
            background-color: rgba(211, 184, 163, 0.8);
            border-color: #876145;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center">
<div id="theme-toggle">
    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
</div>

<div id="app" class="w-full max-w-4xl mx-auto">
    <!-- Main Menu Screen -->
    <div id="main-menu-screen" class="text-center">
        <h1 class="text-5xl font-bold mb-4 glowing-text" style="font-family: 'Orbitron', sans-serif;">Galactic Alphabet Trainer</h1>
        <p class="text-xl mb-8">Werde ein Meister der intergalaktischen Kommunikation.</p>
        <div class="flex flex-col items-center gap-4">
            <button id="campaign-button" class="btn-menu text-white font-bold py-3 px-8 rounded-lg text-2xl w-64">Kampagne</button>
            <button id="endless-mode-button" class="btn-menu text-white font-bold py-3 px-8 rounded-lg text-2xl w-64">Endlos-Modus</button>
        </div>
    </div>

    <!-- Endless Mode Menu Screen -->
    <div id="endless-menu-screen" class="hidden text-center">
        <div class="card rounded-xl p-8 shadow-2xl">
            <h1 class="text-4xl font-bold mb-6 menu-title" style="font-family: 'Orbitron', sans-serif;">Endlos-Modus</h1>
            <div class="flex flex-col items-center gap-4">
                <button data-type="letters" class="btn-endless-select btn-menu text-white font-bold py-3 px-8 rounded-lg text-xl w-64">Buchstaben</button>
                <button data-type="words" class="btn-endless-select btn-menu text-white font-bold py-3 px-8 rounded-lg text-xl w-64">Wörter</button>
                <button data-type="sentences" class="btn-endless-select btn-menu text-white font-bold py-3 px-8 rounded-lg text-xl w-64">Sätze</button>
            </div>
            <button id="back-to-main-menu-1" class="btn-option font-bold py-2 px-6 rounded-lg mt-8">Zurück zum Menü</button>
        </div>
    </div>


    <!-- Main Game Screen -->
    <div id="game-screen" class="hidden">
        <div class="card relative rounded-xl p-6 md:p-8 shadow-2xl">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <h2 id="level-title" class="text-2xl font-bold">Level 1: Buchstaben</h2>
                <div class="text-lg font-bold">Score: <span id="score">0</span></div>
            </div>

            <!-- Progress Bar -->
            <div id="progress-bar-container" class="w-full progress-bar-bg rounded-full h-4 mb-6">
                <div id="progress-bar" class="progress-bar-fill h-4 rounded-full" style="width: 0%"></div>
            </div>

            <button id="back-to-main-menu-2" class="btn-option font-bold py-2 px-4 rounded-lg absolute top-4 left-4 hidden">Menü</button>

            <!-- Question Area -->
            <div class="text-center mb-6">
                <p id="instruction" class="text-lg mb-4">Welcher Buchstabe ist das?</p>
                <div id="question-display" class="question-display-container my-4"></div>
            </div>

            <!-- Answer Options / Input Area -->
            <div id="answer-area">
                <!-- Options for Level 1 -->
                <div id="options-container" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                <!-- Input for Level 2 & 3 -->
                <div id="word-input-area" class="hidden">
                    <div id="input-box" class="input-box rounded-lg p-4 mb-4"></div>
                    <div id="galactic-keyboard" class="grid grid-cols-7 md:grid-cols-9 gap-2 text-center"></div>
                    <div class="flex justify-center mt-4 gap-4">
                        <button id="clear-button" class="btn-option font-bold py-2 px-6 rounded-lg">Löschen</button>
                        <button id="backspace-button" class="btn-option font-bold py-2 px-6 rounded-lg">Zurück</button>
                    </div>
                </div>
            </div>

            <!-- Feedback Message -->
            <div id="feedback-message" class="text-center text-2xl font-bold mt-6 h-8"></div>

            <!-- Next Button -->
            <div class="text-center mt-6">
                <button id="next-button" class="btn-primary text-white font-bold py-3 px-8 rounded-lg text-xl hidden">Weiter</button>
            </div>
        </div>
    </div>

    <!-- Level Complete Screen -->
    <div id="level-complete-screen" class="hidden text-center">
        <div class="card rounded-xl p-8 shadow-2xl">
            <h1 id="level-complete-title" class="text-4xl font-bold mb-4 glowing-text" style="font-family: 'Orbitron', sans-serif;">Level Abgeschlossen!</h1>
            <p class="text-xl mb-6">Du hast die Grundlagen gemeistert. Bereit für die nächste Herausforderung?</p>
            <button id="next-level-button" class="btn-primary text-white font-bold py-3 px-8 rounded-lg text-2xl">Nächstes Level</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const GALACTIC_PIXEL_DATA = {
            'A': [[0,0,1,1,0], [0,1,0,0,1], [0,1,0,0,0], [0,1,0,0,0], [1,1,0,0,0]],
            'B': [[0,0,1,0,0], [0,0,1,0,0], [0,0,0,1,0], [0,0,0,0,1], [1,1,1,1,1]],
            'C': [[0,0,1,0,0], [0,0,0,0,0], [0,0,1,0,0], [0,0,0,1,0], [0,0,0,1,0]],
            'D': [[1,1,1,1,1], [0,0,0,0,0], [1,1,0,0,0], [0,0,1,1,1], [0,0,0,0,0]],
            'E': [[1,0,0,0,1], [1,0,0,0,0], [1,0,0,0,0], [1,0,0,0,0], [1,1,1,1,1]],
            'F': [[1,1,1,1,1], [0,0,0,0,0], [1,0,1,0,1], [0,0,0,0,0], [0,0,0,0,0]],
            'G': [[0,0,0,1,0], [0,0,0,1,0], [0,0,1,1,0], [0,0,0,1,0], [0,0,0,1,0]],
            'H': [[1,1,1,1,1], [0,0,0,0,0], [1,1,1,1,1], [0,0,1,0,0], [0,0,1,0,0]],
            'I': [[0,0,1,0,0], [0,0,1,0,0], [0,0,0,0,0], [0,0,1,0,0], [0,0,1,0,0]],
            'J': [[0,0,1,0,0], [0,0,0,0,0], [0,0,1,0,0], [0,0,0,0,0], [0,0,1,0,0]],
            'K': [[0,0,1,0,0], [0,0,1,0,0], [1,0,1,0,1], [0,0,1,0,0], [0,0,1,0,0]],
            'L': [[0,0,1,0,0], [0,0,1,0,1], [0,0,1,0,0], [0,0,1,0,1], [0,0,1,0,0]],
            'M': [[1,0,0,0,1], [0,0,0,0,1], [0,0,0,0,1], [0,0,0,0,1], [1,1,1,1,1]],
            'N': [[1,0,0,0,1], [1,0,0,0,1], [0,0,0,1,1], [0,0,1,1,0], [1,1,1,0,0]],
            'O': [[1,1,1,1,1], [0,0,0,0,1], [0,0,0,1,1], [0,0,1,1,0], [1,1,1,0,0]],
            'P': [[0,1,0,1,0], [0,0,0,1,0], [0,1,0,1,0], [0,1,0,0,0], [0,1,0,1,0]],
            'Q': [[0,0,1,0,0], [0,0,0,0,0], [1,1,1,1,1], [0,0,0,0,1], [1,1,1,1,1]],
            'R': [[1,0,0,0,1], [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,0], [1,0,0,0,1]],
            'S': [[0,0,1,0,0], [0,0,1,0,0], [0,0,0,1,0], [0,0,0,1,0], [0,0,0,1,0]],
            'T': [[1,1,1,1,1], [0,0,0,0,1], [0,0,0,0,1], [0,0,0,0,0], [0,0,0,0,1]],
            'U': [[0,0,0,0,0], [0,1,0,1,0], [0,0,0,0,0], [0,1,1,1,0], [0,0,0,0,0]],
            'V': [[0,0,1,0,0], [0,0,1,0,0], [1,1,1,1,1], [0,0,0,0,0], [1,1,1,1,1]],
            'W': [[0,0,0,0,0], [0,0,1,0,0], [0,0,0,0,0], [0,1,0,1,0], [0,0,0,0,0]],
            'X': [[1,0,0,0,1], [0,0,0,1,0], [0,0,0,1,0], [0,0,1,0,0], [0,0,1,0,0]],
            'Y': [[0,1,0,1,0], [0,1,0,1,0], [0,1,0,1,0], [0,1,0,1,0], [0,1,0,1,0]],
            'Z': [[0,0,1,0,0], [0,1,0,1,0], [0,1,0,1,0], [0,1,0,1,0], [0,1,0,1,0]]
        };
        const LATIN_ALPHABET = Object.keys(GALACTIC_PIXEL_DATA);
        const WORDS = ["HELLO", "WORLD", "SPACE", "GALAXY", "ALIEN", "STAR", "MOON", "SUN", "ORBIT", "VOID"];
        const SENTENCES = ["WE COME IN PEACE", "TAKE ME TO YOUR LEADER", "THE TRUTH IS OUT THERE", "A GALAXY FAR FAR AWAY"];
        const LEVELS = [
            { id: 1, title: 'Level 1: Buchstaben', questions: LATIN_ALPHABET, type: 'letters' },
            { id: 2, title: 'Level 2: Wörter', questions: WORDS, type: 'words' },
            { id: 3, title: 'Level 3: Sätze', questions: SENTENCES, type: 'sentences' }
        ];
        const QUESTIONS_PER_LEVEL = 10;

        let gameMode = 'campaign'; // 'campaign' or 'endless'
        let endlessType = 'letters'; // 'letters', 'words', 'sentences'
        let currentLevelIndex = 0;
        let currentQuestionIndex = 0;
        let score = 0;
        let questionsForCurrentLevel = [];
        let currentCorrectAnswer = '';
        let userInput = '';

        const body = document.body;
        const mainMenuScreen = document.getElementById('main-menu-screen');
        const endlessMenuScreen = document.getElementById('endless-menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelCompleteScreen = document.getElementById('level-complete-screen');

        const campaignButton = document.getElementById('campaign-button');
        const endlessModeButton = document.getElementById('endless-mode-button');
        const endlessSelectButtons = document.querySelectorAll('.btn-endless-select');
        const backToMainMenu1 = document.getElementById('back-to-main-menu-1');
        const backToMainMenu2 = document.getElementById('back-to-main-menu-2');

        const levelTitle = document.getElementById('level-title');
        const scoreDisplay = document.getElementById('score');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');
        const instruction = document.getElementById('instruction');
        const questionDisplay = document.getElementById('question-display');
        const optionsContainer = document.getElementById('options-container');
        const wordInputArea = document.getElementById('word-input-area');
        const inputBox = document.getElementById('input-box');
        const galacticKeyboard = document.getElementById('galactic-keyboard');
        const clearButton = document.getElementById('clear-button');
        const backspaceButton = document.getElementById('backspace-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const nextButton = document.getElementById('next-button');
        const levelCompleteTitle = document.getElementById('level-complete-title');
        const nextLevelButton = document.getElementById('next-level-button');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('theme-icon-sun');
        const moonIcon = document.getElementById('theme-icon-moon');

        // --- Event Listeners ---
        themeToggle.addEventListener('click', toggleTheme);

        campaignButton.addEventListener('click', startCampaign);
        endlessModeButton.addEventListener('click', showEndlessMenu);
        backToMainMenu1.addEventListener('click', showMainMenu);
        backToMainMenu2.addEventListener('click', showMainMenu);

        endlessSelectButtons.forEach(button => {
            button.addEventListener('click', () => startEndlessMode(button.dataset.type));
        });

        nextButton.addEventListener('click', nextQuestion);
        nextLevelButton.addEventListener('click', startNextLevel);
        clearButton.addEventListener('click', clearInput);
        backspaceButton.addEventListener('click', backspaceInput);

        function showScreen(screen) {
            mainMenuScreen.classList.add('hidden');
            endlessMenuScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            levelCompleteScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        }

        function showMainMenu() {
            showScreen(mainMenuScreen);
        }

        function showEndlessMenu() {
            showScreen(endlessMenuScreen);
        }

        function toggleTheme() {
            body.classList.toggle('light-mode');
            updateThemeIcons();
            if (!wordInputArea.classList.contains('hidden')) {
                buildKeyboard();
            }
        }

        function updateThemeIcons() {
            if (body.classList.contains('light-mode')) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
        }

        function startCampaign() {
            gameMode = 'campaign';
            currentLevelIndex = 0;
            score = 0;
            showScreen(gameScreen);
            setupLevel();
        }

        function startEndlessMode(type) {
            gameMode = 'endless';
            endlessType = type;
            score = 0;
            updateScore();
            showScreen(gameScreen);
            setupLevel();
        }

        function startNextLevel() {
            currentLevelIndex++;
            if (currentLevelIndex >= LEVELS.length) {
                showMainMenu();
                return;
            }
            showScreen(gameScreen);
            setupLevel();
        }

        function setupLevel() {
            currentQuestionIndex = 0;
            updateScore();

            if (gameMode === 'campaign') {
                const level = LEVELS[currentLevelIndex];
                levelTitle.textContent = level.title;
                questionsForCurrentLevel = shuffleArray([...level.questions]).slice(0, QUESTIONS_PER_LEVEL);
                progressBarContainer.classList.remove('hidden');
                backToMainMenu2.classList.remove('hidden'); // KORREKTUR
                if (level.type === 'letters') {
                    optionsContainer.classList.remove('hidden');
                    wordInputArea.classList.add('hidden');
                } else {
                    optionsContainer.classList.add('hidden');
                    wordInputArea.classList.remove('hidden');
                    buildKeyboard();
                }
            } else { // Endless mode
                levelTitle.textContent = `Endlos: ${endlessType.charAt(0).toUpperCase() + endlessType.slice(1)}`;
                progressBarContainer.classList.add('hidden');
                backToMainMenu2.classList.remove('hidden');
                if (endlessType === 'letters') {
                    optionsContainer.classList.remove('hidden');
                    wordInputArea.classList.add('hidden');
                } else {
                    optionsContainer.classList.add('hidden');
                    wordInputArea.classList.remove('hidden');
                    buildKeyboard();
                }
            }
            loadQuestion();
        }

        function loadQuestion() {
            userInput = '';
            updateInputBox();
            feedbackMessage.textContent = '';
            nextButton.classList.add('hidden');
            updateProgressBar();
            questionDisplay.innerHTML = '';

            if (gameMode === 'campaign') {
                if (currentQuestionIndex >= questionsForCurrentLevel.length) {
                    showScreen(levelCompleteScreen);
                    const level = LEVELS[currentLevelIndex];
                    levelCompleteTitle.textContent = `${level.title} Abgeschlossen!`;
                    if (currentLevelIndex >= LEVELS.length - 1) {
                        nextLevelButton.textContent = "Hauptmenü";
                    } else {
                        nextLevelButton.textContent = "Nächstes Level";
                    }
                    return;
                }
                currentCorrectAnswer = questionsForCurrentLevel[currentQuestionIndex];
                const levelType = LEVELS[currentLevelIndex].type;
                setupQuestionUI(levelType, currentCorrectAnswer);

            } else { // Endless mode
                let sourceArray;
                if (endlessType === 'letters') sourceArray = LATIN_ALPHABET;
                else if (endlessType === 'words') sourceArray = WORDS;
                else sourceArray = SENTENCES;
                currentCorrectAnswer = sourceArray[Math.floor(Math.random() * sourceArray.length)];
                setupQuestionUI(endlessType, currentCorrectAnswer);
            }
        }

        function setupQuestionUI(type, answer) {
            if (type === 'letters') {
                const isReverseQuestion = Math.random() < 0.4;
                if (isReverseQuestion) {
                    instruction.textContent = "Welches galaktische Zeichen ist das?";
                    const questionTextEl = document.createElement('div');
                    questionTextEl.textContent = answer;
                    questionTextEl.className = 'text-8xl font-bold';
                    questionDisplay.appendChild(questionTextEl);
                    generateGalacticOptions(answer);
                } else {
                    instruction.textContent = "Welcher Buchstabe ist das?";
                    questionDisplay.appendChild(createPixelCharacter(answer, 12));
                    generateLatinOptions(answer);
                }
            } else { // Words and Sentences
                instruction.textContent = type === 'words' ? "Schreibe das Wort:" : "Übersetze den Satz:";
                const questionTextEl = document.createElement('div');
                questionTextEl.textContent = answer;
                questionTextEl.className = 'text-3xl font-bold tracking-widest';
                questionDisplay.appendChild(questionTextEl);
                checkWordAnswer();
            }
        }

        function generateLatinOptions(correctLetter) {
            optionsContainer.innerHTML = '';
            let options = [correctLetter];
            while (options.length < 4) {
                const randomLetter = LATIN_ALPHABET[Math.floor(Math.random() * LATIN_ALPHABET.length)];
                if (!options.includes(randomLetter)) options.push(randomLetter);
            }
            options = shuffleArray(options);
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('btn-option', 'font-bold', 'py-4', 'px-5', 'rounded-lg', 'text-2xl');
                button.addEventListener('click', () => checkLetterAnswer(option, button));
                optionsContainer.appendChild(button);
            });
        }

        function generateGalacticOptions(correctLetter) {
            optionsContainer.innerHTML = '';
            let options = [correctLetter];
            while (options.length < 4) {
                const randomLetter = LATIN_ALPHABET[Math.floor(Math.random() * LATIN_ALPHABET.length)];
                if (!options.includes(randomLetter)) options.push(randomLetter);
            }
            options = shuffleArray(options);
            options.forEach(option => {
                const button = document.createElement('button');
                button.dataset.letter = option;
                button.classList.add('btn-option', 'p-4', 'rounded-lg');
                button.appendChild(createPixelCharacter(option, 6));
                button.addEventListener('click', () => checkLetterAnswer(option, button));
                optionsContainer.appendChild(button);
            });
        }

        function checkLetterAnswer(selectedOption, button) {
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);

            if (selectedOption === currentCorrectAnswer) {
                feedbackMessage.textContent = 'Korrekt!';
                feedbackMessage.style.color = '#22c55e';
                button.classList.add('correct');
                score += 10;
                updateScore();
            } else {
                feedbackMessage.textContent = `Falsch! Richtig wäre: ${currentCorrectAnswer}`;
                feedbackMessage.style.color = '#ef4444';
                button.classList.add('incorrect');
                buttons.forEach(btn => {
                    if (btn.textContent === currentCorrectAnswer || btn.dataset.letter === currentCorrectAnswer) {
                        btn.classList.add('correct');
                    }
                });
            }
            nextButton.classList.remove('hidden');
        }

        function buildKeyboard() {
            galacticKeyboard.innerHTML = '';
            const keys = shuffleArray([...LATIN_ALPHABET]);
            keys.forEach(key => {
                const keyElement = document.createElement('div');
                keyElement.classList.add('keyboard-key', 'btn-option', 'p-2', 'rounded-md');
                keyElement.dataset.key = key;
                keyElement.appendChild(createPixelCharacter(key, 3));
                keyElement.addEventListener('click', () => handleKeyPress(key));
                galacticKeyboard.appendChild(keyElement);
            });
            const spacebar = document.createElement('div');
            spacebar.textContent = 'SPACE';
            spacebar.classList.add('keyboard-key', 'btn-option', 'p-2', 'rounded-md', 'col-span-3', 'md:col-span-2');
            spacebar.addEventListener('click', () => handleKeyPress(' '));
            galacticKeyboard.appendChild(spacebar);
        }

        function handleKeyPress(key) {
            userInput += key;
            updateInputBox();
            checkWordAnswer();
        }

        function updateInputBox() {
            inputBox.innerHTML = '';
            for(const char of userInput) {
                if (char === ' ') {
                    const space = document.createElement('div');
                    space.style.width = '20px';
                    inputBox.appendChild(space);
                } else {
                    inputBox.appendChild(createPixelCharacter(char, 5));
                }
            }
        }

        function clearInput() {
            userInput = '';
            updateInputBox();
            checkWordAnswer();
        }

        function backspaceInput() {
            userInput = userInput.slice(0, -1);
            updateInputBox();
            checkWordAnswer();
        }

        function checkWordAnswer() {
            if (userInput === currentCorrectAnswer) {
                feedbackMessage.textContent = 'Perfekt!';
                feedbackMessage.style.color = '#22c55e';
                score += 20;
                updateScore();
                nextButton.classList.remove('hidden');
                galacticKeyboard.querySelectorAll('.keyboard-key').forEach(k => k.style.pointerEvents = 'none');
            } else {
                feedbackMessage.textContent = '';
                nextButton.classList.add('hidden');
                galacticKeyboard.querySelectorAll('.keyboard-key').forEach(k => k.style.pointerEvents = 'auto');
            }
        }

        function nextQuestion() {
            if (gameMode === 'campaign') {
                currentQuestionIndex++;
            }
            loadQuestion();
        }

        function createPixelCharacter(latinChar, pixelSize = 4) {
            const matrix = GALACTIC_PIXEL_DATA[latinChar];
            if (!matrix) return document.createElement('span');

            const container = document.createElement('div');
            let maxWidth = 0;
            matrix.forEach(row => {
                if(row.length > maxWidth) maxWidth = row.length;
            });

            container.style.display = 'inline-grid';
            container.style.gridTemplateColumns = `repeat(${maxWidth}, 1fr)`;
            container.style.gap = `0px`;
            container.style.alignSelf = 'center';

            for (let r = 0; r < matrix.length; r++) {
                for (let c = 0; c < maxWidth; c++) {
                    const pixel = document.createElement('div');
                    pixel.style.width = `${pixelSize}px`;
                    pixel.style.height = `${pixelSize * 1.25}px`;
                    if (matrix[r] && matrix[r][c] === 1) {
                        pixel.classList.add('pixel-on');
                    }
                    container.appendChild(pixel);
                }
            }
            return container;
        }

        function updateScore() {
            scoreDisplay.textContent = score;
        }

        function updateProgressBar() {
            if(gameMode === 'campaign') {
                const progress = (currentQuestionIndex / QUESTIONS_PER_LEVEL) * 100;
                progressBar.style.width = `${progress}%`;
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initial setup
        updateThemeIcons();
        showMainMenu();
    });
</script>
</body>
</html>
